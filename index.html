<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>TenRizoto</title>
  <style>
    body {
  font-family: Arial, sans-serif;
  line-height: 1.6;
  margin: 20px;
}

h1, h2 {
  color: #cc3366;
}

#articles-list li {
  margin-bottom: 20px;
}

.prefix {
  color: #555;
  font-style: italic;
}

.date {
  font-size: 0.9em;
  color: #888;
}

#article-section a {
  display: inline-block;
  margin-top: 20px;
  text-decoration: none;
  color: #cc3366;
}
  </style>
</head>
<body>
  <h1>Blog</h1>

<section id="articles-section">
  <ul id="articles-list"></ul>
  <button id="load-more" style="display:none;">Načíst další</button>
</section>
  
  <section id="article-section" style="display:none;">
    <div id="article-content"></div>
    <a href="/">← Zpět na seznam článků</a>
  </section>

  <script>const API_KEY = "iR0SFubwR8Z9WmdYD0gnkODNxTsC6amBlN6X4jMtoTjM1Z8Zyw";
const BLOG_NAME = "tenrizoto";
const PREFIX_LENGTH = 200; // kolik znaků ukázat v náhledu
const LIMIT = 20;          // kolik článků načíst na jeden request

let offset = 0;            // od kterého článku začít
let allLoaded = false;     // jestli už došly články

function getQueryParam(name) {
  const params = new URLSearchParams(window.location.search);
  return params.get(name);
}

async function fetchArticles() {
  const res = await fetch(`https://api.tumblr.com/v2/blog/${BLOG_NAME}.tumblr.com/posts?api_key=${API_KEY}&limit=${LIMIT}&offset=${offset}`);
  const data = await res.json();
  return data.response.posts;
}

async function showArticles(initial = false) {
  const posts = await fetchArticles();
  const list = document.getElementById("articles-list");

  // pokud první načítání, vymaž seznam
  if (initial) {
    list.innerHTML = "";
    offset = 0;
    allLoaded = false;
  }

  if (!posts || posts.length === 0) {
    allLoaded = true;
    document.getElementById("load-more").style.display = "none";
    return;
  }

  posts.forEach(post => {
    const li = document.createElement("li");
    const title = post.title || "Bez názvu";
    const date = new Date(post.date).toLocaleDateString();
    const prefix = post.body.replace(/<[^>]*>?/gm, '').substring(0, PREFIX_LENGTH);
    const slug = post.slug;

    li.innerHTML = `<a href="?article=${slug}">${title}</a> <span class="date">${date}</span><br><p class="prefix">${prefix}...</p>`;
    list.appendChild(li);
  });

  // posuň offset pro příští request
  offset += LIMIT;

  // schovej load more, pokud došlo článků
  if (posts.length < LIMIT) {
    allLoaded = true;
    document.getElementById("load-more").style.display = "none";
  } else {
    document.getElementById("load-more").style.display = "block";
  }
}

async function showArticle(slug) {
  const res = await fetch(`https://api.tumblr.com/v2/blog/${BLOG_NAME}.tumblr.com/posts?api_key=${API_KEY}&slug=${slug}`);
  const data = await res.json();
  const post = data.response.posts[0];
  if (!post) return;

  document.getElementById("articles-section").style.display = "none";
  const container = document.getElementById("article-content");
  container.innerHTML = `<h2>${post.title}</h2>
                         <span class="date">${new Date(post.date).toLocaleDateString()}</span>
                         <div>${post.body}</div>
                         <a href="/">← Zpět na seznam článků</a>`;
  document.getElementById("article-section").style.display = "block";
}

const slug = getQueryParam("article");
if (slug) {
  showArticle(slug);
} else {
  showArticles(true);

  // navážeme klik na tlačítko
  document.getElementById("load-more").addEventListener("click", () => {
    if (!allLoaded) {
      showArticles();
    }
  });
}
  </script>
</body>
</html>
